@using WBBEntity.PanelModels;
@{
    Layout = null;

    string L_WELCOME = "";
    string L_WELCOME_DESC = "";
    string L_ENTER_MOBILE = "";
    string L_MOBILE_NO = "";
    string L_MOBILE_NO_EX = "";
    string FBB_Con_Length_Mobile_No = "";
    string FBB_Con_Input_Moblie_No = "";
    string B_CONTINUE = "";
    string L_FILL_OUT = "";
    string PREPAID_USAGE = "";    

    string L_ERRCAMOBILE = "";
    string L_ERR_NOT_FOUND = "not found";

    if (ViewBag.FbbConstant != null)
    {
        var FbbConstant = (List<FbbConstantModel>)ViewBag.FbbConstant;
        FBB_Con_Length_Mobile_No = FbbConstant.Any(f => f.Field == "Mobile Length") ? FbbConstant.First(f => f.Field == "Mobile Length").Validation : "";
        FBB_Con_Input_Moblie_No = FbbConstant.Any(f => f.Field == "Input_MobileNo") ? FbbConstant.First(f => f.Field == "Input_MobileNo").Validation : "";
        PREPAID_USAGE = FbbConstant.Any(f => f.Field == "PREPAID_USAGE") ? FbbConstant.First(f => f.Field == "PREPAID_USAGE").Validation : "";
    }

    if (ViewBag.LabelFBBTR001 != null)
    {
        var LabelFBBTR001 = (List<LovScreenValueModel>)ViewBag.LabelFBBTR001;
        B_CONTINUE = LabelFBBTR001.Any(c => c.Name == "B_CONTINUE") ? LabelFBBTR001.FirstOrDefault(c => c.Name == "B_CONTINUE").DisplayValue : "";
        L_FILL_OUT = LabelFBBTR001.Any(c => c.Name == "L_FILL_OUT") ? LabelFBBTR001.FirstOrDefault(c => c.Name == "L_FILL_OUT").DisplayValue : "";
    }

    if (ViewBag.LabelFBBTR016 != null)
    {
        var labelFBBTR016 = (List<LovScreenValueModel>)ViewBag.LabelFBBTR016;
        L_MOBILE_NO = labelFBBTR016.Any(c => c.Name == "L_MOBILE_NO") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_MOBILE_NO").DisplayValue : "";
        L_WELCOME = labelFBBTR016.Any(c => c.Name == "L_WELCOME") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_WELCOME").DisplayValue : "";
        L_WELCOME_DESC = labelFBBTR016.Any(c => c.Name == "L_WELCOME_DESC") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_WELCOME_DESC").DisplayValue : "";
        L_ENTER_MOBILE = labelFBBTR016.Any(c => c.Name == "L_ENTER_MOBILE") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_ENTER_MOBILE").DisplayValue : "";
        L_MOBILE_NO_EX = labelFBBTR016.Any(c => c.Name == "L_MOBILE_NO_EX") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_MOBILE_NO_EX").DisplayValue : "";
        L_ERRCAMOBILE = labelFBBTR016.Any(c => c.Name == "L_ERRCAMOBILE") ? labelFBBTR016.FirstOrDefault(c => c.Name == "L_ERRCAMOBILE").DisplayValue : "";
    }    
}

<div class="col-sm-6 col-md-6 i-hidden" id="col-formInputMobileNo">

    <h1>@L_WELCOME</h1>
    <p>@L_WELCOME_DESC</p>
    <p>@L_ENTER_MOBILE</p>
    <br />

    <h3 style="margin-bottom:0px">@L_MOBILE_NO</h3>
    <input type="text" class="form-control" id="L_MOBILE_NOs" maxlength="@FBB_Con_Length_Mobile_No" autocomplete="off" title="@L_FILL_OUT" />

    <br />

    <p align="left">
        <a class="btn1" id="btnSendOTP1">@B_CONTINUE</a>
        <a class="btn2 i-hidden" id="btnSendOTP2" onclick="CheckChangeContactBeforeOTP()">@B_CONTINUE</a>
    </p>
</div>

<input type='hidden' name='GSSO_transactionID' id='GSSO_transactionID' />
<input type='hidden' name='PREPAID_USAGE' id='PREPAID_USAGE' value="@PREPAID_USAGE" />
<input type='hidden' name='IsAPRUEnough' id='IsAPRUEnough' />

<script type="text/javascript">
    $(function () {
        $("#L_MOBILE_NOs").keyup(function () {
            CheckKeyUps("L_MOBILE_NOs", "@FBB_Con_Input_Moblie_No");
            checkBeforeNextProcess();
        });
        $("#L_MOBILE_NOs").watermark("@L_MOBILE_NO_EX");
    });

    function checkBeforeNextProcess() {
        if ($("#L_MOBILE_NOs").val().length == "@FBB_Con_Length_Mobile_No") {
            var firstMobileNo = $("#L_MOBILE_NOs").val().substr(0, 1);
            var threeMobileNo = $("#L_MOBILE_NOs").val().substr(0, 3);
            if (firstMobileNo == "0" && threeMobileNo != "007") {
                $("#btnSendOTP1").hide();
                $("#btnSendOTP2").show();
            }
            else {
                $("#btnSendOTP1").show();
                $("#btnSendOTP2").hide();
            }
        }
        else {
            $("#btnSendOTP1").show();
            $("#btnSendOTP2").hide();
        }
    }

    function CheckChangeContactBeforeOTP()
    {
        LockScreen(true);//R24.04 Add loading block screen by max kunlp885
        //GetCCCustInfo();
        GetCheckMobileOnlineQuery();//R22.07 Issue Check Mobile OnlineQuery

        if ($("#L_MOBILE_NOs").val() != $("#old_relate_mobile").val()) {
            if ($("#relate_mobile_action").val() == "") {
                if ($("#old_relate_mobile").val() == "") {
                    if ($("#CoveragePanelModel_ChargeType").val() == "NONAIS") {
                        $("#relate_mobile_action").val("");
                    }
                    else {
                        //Add
                        $("#relate_mobile_action").val("Add");
                    }
                }
                else {
                    if ($("#CoveragePanelModel_ChargeType").val() == "NONAIS") {
                        //Delete
                        $("#relate_mobile_action").val("Delete");
                    }
                    else {
                        //Replace
                        $("#relate_mobile_action").val("Replace");
                    }
                }
            }
            else {
                $("#relate_mobile_action").val("");
            }
        }
        else {
            $("#relate_mobile_action").val("");
        }
        RequestOTPFunc();
    }

    function RequestOTPFunc() {
        $("#btnSendOTP2").hide();
        $("#col-Condition").hide();
        $("#outMobileNo").val($("#L_MOBILE_NOs").val());
        $("#CustomerRegisterPanelModel_L_MOBILE").val($("#L_MOBILE_NOs").val());

        if ($('#CoveragePanelModel_ChargeType').val() == "PREPAID") {
            $.ajax({
                url: '/Process/SendOneTimePW',
                data: { msisdn: $.trim($("#L_MOBILE_NOs").val()), accountType: $("#CoveragePanelModel_ChargeType").val() },
                dataType: "json",
                type: 'POST',
                async: false,
                success: function (data3) {
                    if (data3.code == "000") {
                        $('#GSSO_transactionID').val(data3.transactionID);
                        //SubmitOTP();
                        $("#FromPage").val("col-formInputMobileNo");
                        $("#col-formInputOTP").show();
                    }
                    else {
                        $('#col-form').hide();
                        $("#col-ChangeContactMobile").hide();
                        $('#col-formInputMobileNo').hide();
                        $("#FromPage").val("col-formInputOTP");
                        $('#col-OTP').hide();
                        $('#lb-failed').html('@L_ERR_NOT_FOUND');
                        $('#col-err').show();
                    }
                }
            });
        }
        else {
            if (!$("#col-err").is(":visible")) {
                nextToPersonalInfo();
            }
        }
    }

    function GetCCCustInfo() {
        //debugger;
        $.ajax({
            url: '/CheckCoverage/GetCCCustInfoQuery',
            data: { mobileNo: $.trim($("#L_MOBILE_NOs").val()) },
            dataType: "json",
            type: 'POST',
            async: false,
            success: function (response) {
                var data = response.data;
                if (data) {
                    $.ajax({
                        url: '/CheckCoverage/GetCCCustInfo',
                        data: { key: data.GUIDKEY, },
                        dataType: "json",
                        type: 'POST',
                        async: false,
                        success: function (response) {

                            var data = response.data;

                            var mobseg = base64_decode(data.V1);
                            var nettype = base64_decode(data.V2);

                            var chkMobileStatus = data.STATE.toUpperCase();
                            $('#CoveragePanelModel_MobileStatus').val(data.STATE);

                            $('#CoveragePanelModel_MobileSegment').val(mobseg);
                            var chkNetworkType = nettype;

                            $("#chkSubNetworkType").val(data.TYPE);
                            var chkSubNetworkType = data.TYPE;

                            if (chkSubNetworkType == "Pre-paid") {
                                $('#CoveragePanelModel_ChargeType').val("PREPAID");
                            }
                            else if (chkSubNetworkType == "Post-paid") {
                                $('#CoveragePanelModel_ChargeType').val("POSTPAID");
                                $.ajax({
                                    url: '/CheckCoverage/evESeServiceQueryMassCommonAccountInfo',
                                    data: { mobileNo: codefbb.fbbMessage($("#L_MOBILE_NOs").val()), SubNetworkType: "POSTPAID", cardNo: "", cardType: "" },
                                    dataType: "json",
                                    type: 'POST',
                                    async: false,
                                    success: function (response) {
                                        var data4 = response.data;

                                        $.ajax({
                                            url: '/CheckCoverage/GetCheckChanvePackageProcess',
                                            data: { key: data4.GUIDKEY, },
                                            dataType: "json",
                                            type: 'POST',
                                            async: false,
                                            success: function (response) {
                                                var data5 = response.data;

                                                if(data5.outAccountNumber != $("#outAccountNumber").val())
                                                {
                                                    $("#col-formInputMobileNo").hide();
                                                    $("#col-ChangeContactMobile").hide();
                                                    $("#col-Condition").hide();
                                                    $("#col-err").show();
                                                    $("#lb-failed").html("@L_ERRCAMOBILE.");
                                                    $("#FromPage").val("col-formInputMobileNo");
                                                }
                                            }
                                        });
                                    }
                                });
                            }
                            else {
                                //$('#CoveragePanelModel_ChargeType').val(chkSubNetworkType);
                                $('#CoveragePanelModel_ChargeType').val("NONAIS");
                            }

                            $('#CustomerRegisterPanelModel_L_CARD_NO').val($.trim($("#L_MOBILE_NOs").val()));

                            if (chkNetworkType == "01") {
                                $('#CoveragePanelModel_NetworkType').val("2G");
                            } else if (chkNetworkType == "23") {
                                $('#CoveragePanelModel_NetworkType').val("2G");
                            } else if (chkNetworkType == "03") {
                                $('#CoveragePanelModel_NetworkType').val("3G");
                            } else {
                                $('#CoveragePanelModel_NetworkType').val(chkNetworkType);
                            }

                            var outMobileSegment = "";
                            outMobileSegment = mobseg.toUpperCase();
                            if (outMobileSegment == "EMERALD" || outMobileSegment == "GOLD" || outMobileSegment == "PLATINUM" ||
                                                    outMobileSegment == "PLATINUM PLUS" || outMobileSegment == "SERANADE CEO" || outMobileSegment == "SERENADE PRESTIGE") {
                                $("#HdchkSerenade_Flag").val('Y');
                                $('#CoveragePanelModel_Serenade_Flag').val('Y');
                            }
                            else if (outMobileSegment == "CLASSIC" && $('#CoveragePanelModel_ChargeType').val() == "POSTPAID") {
                                $("#HdchkSerenade_Flag").val("N");
                                $('#CoveragePanelModel_Serenade_Flag').val("N");
                            }
                            else {
                                var ARPU = 0;
                                if ("Pre-paid" == chkSubNetworkType) {
                                    $.ajax({
                                        url: '/CheckCoverage/GetMobileDataUsage',
                                        data: { mobileNo: $.trim($("#L_MOBILE_NOs").val()), networkType: $('#CoveragePanelModel_ChargeType').val() },
                                        dataType: "json",
                                        type: 'POST',
                                        async: false,
                                        success: function (data3) {
                                            if (data3 != null) {
                                                if (data3.ARPU != undefined) {
                                                    $('#CoveragePanelModel_ARPU').val(data3.ARPU);
                                                    ARPU = data3.ARPU;
                                                }
                                            }
                                        }
                                    });

                                    if (parseFloat(ARPU) >= parseFloat('@PREPAID_USAGE')) {
                                        $("#IsAPRUEnough").val("Y");
                                        $("#HdchkSerenade_Flag").val("N");
                                        $('#CoveragePanelModel_Serenade_Flag').val("N");
                                    }
                                    else {
                                        $("#IsAPRUEnough").val("N");
                                        $("#HdchkSerenade_Flag").val("");
                                        $('#CoveragePanelModel_Serenade_Flag').val("");
                                    }
                                }
                                else if ("Post-paid" == chkSubNetworkType) {
                                    $("#HdchkSerenade_Flag").val("N");
                                    $('#CoveragePanelModel_Serenade_Flag').val("N");
                                }
                                else {
                                    $("#HdchkSerenade_Flag").val("");
                                    $('#CoveragePanelModel_Serenade_Flag').val("");
                                }
                            }

                            if (chkNetworkType == "03" &&
                                (chkMobileStatus == "ACTIVE" || chkMobileStatus == "SA" || chkMobileStatus == "SS" || chkMobileStatus.indexOf("SUSPEND") > -1)) {//เป็นหมายเลขAIS

                                $.ajax({
                                    url: '/Process/evESeServiceQueryMassCommonAccountInfo',
                                    data: { mobileNo: codefbb.fbbMessage($("#L_MOBILE_NOs").val()), SubNetworkType: "PREPAID" },
                                    dataType: "json",
                                    type: 'POST',
                                    async: false,
                                    success: function (response) {
                                        var data2 = response.data;
                                        if (data2.errorMessage == "") {
                                            $.ajax({
                                                url: '/Process/GetCheckProcess',
                                                data: { key: data2.GUIDKEY, },
                                                dataType: "json",
                                                type: 'POST',
                                                async: false,
                                                success: function (response) {
                                                    var data2 = response.data;

                                                    var ProjectName = "";
                                                    if (data2.projectName != undefined) {
                                                        ProjectName = data2.projectName.toUpperCase();
                                                    }
                                                    if ($("#L_MOBILE_NOs").val() != $("#old_relate_mobile").val() && (ProjectName == "TRIPLE PLAY" || ProjectName == "FMB1")) {
                                                        $("#HdchkSerenade_Flag").val("");
                                                        $('#CoveragePanelModel_Serenade_Flag').val("");
                                                        $("#relate_mobile_action").val("USED_BUNDLING");
                                                    }
                                                    $('#returnContactMobile').val(data2.outServiceMobileNo);
                                                }
                                            });
                                        }
                                        else {
                                            $("#HdchkSerenade_Flag").val("");
                                            $('#CoveragePanelModel_Serenade_Flag').val("");
                                        }
                                    }
                                });
                            }
                            else {
                                $("#CoveragePanelModel_ChargeType").val("NONAIS");
                                $("#HdchkSerenade_Flag").val("");
                                $('#CoveragePanelModel_Serenade_Flag').val("");
                            }
                        }
                    });
                }
                else {
                    $("#CoveragePanelModel_ChargeType").val("NONAIS");
                    $("#HdchkSerenade_Flag").val("");
                    $('#CoveragePanelModel_Serenade_Flag').val("");
                }
            }
        });
    }

    //R22.07 Issue Check Mobile OnlineQuery
    function GetCheckMobileOnlineQuery() {
        $.ajax({
            url: '/CheckCoverage/GetCheckMobileOnlineQuery',
            data: {
                mobileNo: $.trim($("#L_MOBILE_NOs").val()),
                fibreID: '',
                locationCode: ''
            },
            dataType: "json",
            type: 'POST',
            async: false,
            success: function (response) {

                var data = response.PersonalInfo;
                var mobseg = data.MOBILE_SEGMENT.toUpperCase();
                var nettype = data.NETWORK_TYPE;

                var chkMobileStatus = data.MOBILE_NO_STATUS.toUpperCase();
                $('#CoveragePanelModel_MobileStatus').val(data.MOBILE_NO_STATUS);

                $('#CoveragePanelModel_MobileSegment').val(mobseg);
                var chkNetworkType = nettype;

                $("#chkSubNetworkType").val(data.SUB_NETWORK_TYPE);
                var chkSubNetworkType = data.SUB_NETWORK_TYPE;

                if (chkSubNetworkType == "Pre-paid") {
                    $('#CoveragePanelModel_ChargeType').val("PREPAID");
                }
                else if (chkSubNetworkType == "Post-paid") {
                    $('#CoveragePanelModel_ChargeType').val("POSTPAID");
                    $.ajax({
                        url: '/CheckCoverage/evESeServiceQueryMassCommonAccountInfo',
                        data: { mobileNo: codefbb.fbbMessage($("#L_MOBILE_NOs").val()), SubNetworkType: "POSTPAID", cardNo: "", cardType: "" },
                        dataType: "json",
                        type: 'POST',
                        async: false,
                        success: function (response) {
                            var data4 = response.data;

                            $.ajax({
                                url: '/CheckCoverage/GetCheckChanvePackageProcess',
                                data: { key: data4.GUIDKEY, },
                                dataType: "json",
                                type: 'POST',
                                async: false,
                                success: function (response) {
                                    var data5 = response.data;

                                    if (data5.outAccountNumber != $("#outAccountNumber").val()) {
                                        $("#col-formInputMobileNo").hide();
                                        $("#col-ChangeContactMobile").hide();
                                        $("#col-Condition").hide();
                                        $("#col-err").show();
                                        $("#lb-failed").html("@L_ERRCAMOBILE.");
                                        $("#FromPage").val("col-formInputMobileNo");
                                    }
                                }
                            });
                        }
                    });
                }
                else {
                    //$('#CoveragePanelModel_ChargeType').val(chkSubNetworkType);
                    $('#CoveragePanelModel_ChargeType').val("NONAIS");
                }

                $('#CustomerRegisterPanelModel_L_CARD_NO').val($.trim($("#L_MOBILE_NOs").val()));

                if (chkNetworkType == "01") {
                    $('#CoveragePanelModel_NetworkType').val("2G");
                } else if (chkNetworkType == "23") {
                    $('#CoveragePanelModel_NetworkType').val("2G");
                } else if (chkNetworkType == "03") {
                    $('#CoveragePanelModel_NetworkType').val("3G");
                } else {
                    $('#CoveragePanelModel_NetworkType').val(chkNetworkType);
                }

                var outMobileSegment = "";
                outMobileSegment = mobseg.toUpperCase();
                if (outMobileSegment == "EMERALD" || outMobileSegment == "GOLD" || outMobileSegment == "PLATINUM" ||
                    outMobileSegment == "PLATINUM PLUS" || outMobileSegment == "SERANADE CEO" || outMobileSegment == "SERENADE PRESTIGE") {
                    $("#HdchkSerenade_Flag").val('Y');
                    $('#CoveragePanelModel_Serenade_Flag').val('Y');
                }
                else if (outMobileSegment == "CLASSIC" && $('#CoveragePanelModel_ChargeType').val() == "POSTPAID") {
                    $("#HdchkSerenade_Flag").val("N");
                    $('#CoveragePanelModel_Serenade_Flag').val("N");
                }
                else {
                    var ARPU = 0;
                    if ("Pre-paid" == chkSubNetworkType) {
                        $.ajax({
                            url: '/CheckCoverage/GetMobileDataUsage',
                            data: { mobileNo: $.trim($("#L_MOBILE_NOs").val()), networkType: $('#CoveragePanelModel_ChargeType').val() },
                            dataType: "json",
                            type: 'POST',
                            async: false,
                            success: function (data3) {
                                if (data3 != null) {
                                    if (data3.ARPU != undefined) {
                                        $('#CoveragePanelModel_ARPU').val(data3.ARPU);
                                        ARPU = data3.ARPU;
                                    }
                                }
                            }
                        });

                        if (parseFloat(ARPU) >= parseFloat('@PREPAID_USAGE')) {
                            $("#IsAPRUEnough").val("Y");
                            $("#HdchkSerenade_Flag").val("N");
                            $('#CoveragePanelModel_Serenade_Flag').val("N");
                        }
                        else {
                            $("#IsAPRUEnough").val("N");
                            $("#HdchkSerenade_Flag").val("");
                            $('#CoveragePanelModel_Serenade_Flag').val("");
                        }
                    }
                    else if ("Post-paid" == chkSubNetworkType) {
                        $("#HdchkSerenade_Flag").val("N");
                        $('#CoveragePanelModel_Serenade_Flag').val("N");
                    }
                    else {
                        $("#HdchkSerenade_Flag").val("");
                        $('#CoveragePanelModel_Serenade_Flag').val("");
                    }
                }

                if (chkNetworkType == "03" &&
                    (chkMobileStatus == "ACTIVE" || chkMobileStatus == "SA" || chkMobileStatus == "SS" || chkMobileStatus.indexOf("SUSPEND") > -1)) {//เป็นหมายเลขAIS

                    $.ajax({
                        url: '/Process/evESeServiceQueryMassCommonAccountInfo',
                        data: { mobileNo: codefbb.fbbMessage($("#L_MOBILE_NOs").val()), SubNetworkType: "PREPAID" },
                        dataType: "json",
                        type: 'POST',
                        async: false,
                        success: function (response) {
                            var data2 = response.data;
                            if (data2.errorMessage == "") {
                                $.ajax({
                                    url: '/Process/GetCheckProcess',
                                    data: { key: data2.GUIDKEY, },
                                    dataType: "json",
                                    type: 'POST',
                                    async: false,
                                    success: function (response) {
                                        var data2 = response.data;

                                        var ProjectName = "";
                                        if (data2.projectName != undefined) {
                                            ProjectName = data2.projectName.toUpperCase();
                                        }
                                        if ($("#L_MOBILE_NOs").val() != $("#old_relate_mobile").val() && (ProjectName == "TRIPLE PLAY" || ProjectName == "FMB1")) {
                                            $("#HdchkSerenade_Flag").val("");
                                            $('#CoveragePanelModel_Serenade_Flag').val("");
                                            $("#relate_mobile_action").val("USED_BUNDLING");
                                        }
                                        $('#returnContactMobile').val(data2.outServiceMobileNo);
                                    }
                                });
                            }
                            else {
                                $("#HdchkSerenade_Flag").val("");
                                $('#CoveragePanelModel_Serenade_Flag').val("");
                            }
                        }
                    });
                }
                else {
                    $("#CoveragePanelModel_ChargeType").val("NONAIS");
                    $("#HdchkSerenade_Flag").val("");
                    $('#CoveragePanelModel_Serenade_Flag').val("");
                }
            }
        });
    }

    function base64_decode(str) {
        if (window.atob) // Internet Explorer 10 and above
            return decodeURIComponent(escape(window.atob(str)));
        else {
            // Cross-Browser Method (compressed)

            // Create Base64 Object
            var Base64 = { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (e) { var t = ""; var n, r, i, s, o, u, a; var f = 0; e = Base64._utf8_encode(e); while (f < e.length) { n = e.charCodeAt(f++); r = e.charCodeAt(f++); i = e.charCodeAt(f++); s = n >> 2; o = (n & 3) << 4 | r >> 4; u = (r & 15) << 2 | i >> 6; a = i & 63; if (isNaN(r)) { u = a = 64 } else if (isNaN(i)) { a = 64 } t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a) } return t }, decode: function (e) { var t = ""; var n, r, i; var s, o, u, a; var f = 0; e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""); while (f < e.length) { s = this._keyStr.indexOf(e.charAt(f++)); o = this._keyStr.indexOf(e.charAt(f++)); u = this._keyStr.indexOf(e.charAt(f++)); a = this._keyStr.indexOf(e.charAt(f++)); n = s << 2 | o >> 4; r = (o & 15) << 4 | u >> 2; i = (u & 3) << 6 | a; t = t + String.fromCharCode(n); if (u != 64) { t = t + String.fromCharCode(r) } if (a != 64) { t = t + String.fromCharCode(i) } } t = Base64._utf8_decode(t); return t }, _utf8_encode: function (e) { e = e.replace(/\r\n/g, "\n"); var t = ""; for (var n = 0; n < e.length; n++) { var r = e.charCodeAt(n); if (r < 128) { t += String.fromCharCode(r) } else if (r > 127 && r < 2048) { t += String.fromCharCode(r >> 6 | 192); t += String.fromCharCode(r & 63 | 128) } else { t += String.fromCharCode(r >> 12 | 224); t += String.fromCharCode(r >> 6 & 63 | 128); t += String.fromCharCode(r & 63 | 128) } } return t }, _utf8_decode: function (e) { var t = ""; var n = 0; var r = c1 = c2 = 0; while (n < e.length) { r = e.charCodeAt(n); if (r < 128) { t += String.fromCharCode(r); n++ } else if (r > 191 && r < 224) { c2 = e.charCodeAt(n + 1); t += String.fromCharCode((r & 31) << 6 | c2 & 63); n += 2 } else { c2 = e.charCodeAt(n + 1); c3 = e.charCodeAt(n + 2); t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63); n += 3 } } return t } }
            // Encode the String
            return decodeURIComponent(escape(Base64.decode(str)));
        }
    }
</script>