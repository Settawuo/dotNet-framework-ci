<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>PDF.js</title>
    <!-- Bootstrap core CSS-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="css/main.css" rel="stylesheet">
</head>

<body>
    <header class="navbar navbar-default navbar-static-top">
        <div class="container">
            
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav" style="float:right">
                    <li id="testPrint"><a onclick="printHTML()" style="cursor:pointer">Print</a></li>
                </ul>
            </div>
        </div>
    </header>
    <div id="mainContainer" class="container">
        <div class="starter-template">
            <section class="content">
                <p class="text-center">
                    <canvas id="canvas1"></canvas>
                    <canvas id="canvas2"></canvas>
                    <img id="img1" style="display:none" src="" />
                    <img id="img2" style="display:none" src="" />
                </p>
            </section>
        </div>
    </div>
    <div class="container">
        <footer>
        </footer>
    </div>
    <!-- Bootstrap core JavaScript-->
    <script src="js/jquery-2.1.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="/Content/Content2016/js/pdf.js"></script>
    <script src="/Content/Content2016/js/pdf.worker.js"></script>
    <script>

        $.ajax({
            type: "GET",
            url: "/Process/GetPDF",
            dataType: "json",
            success: function (data) {
                console.log("GetPDF from SESSION")
                showInCanvas(data);
            }
        });

        function convertDataURIToBinary(dataURI) {
            var BASE64_MARKER = ';base64,';
            var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;
            var base64 = dataURI.substring(base64Index);
            var raw = window.atob(base64);
            var rawLength = raw.length;
            var array = new Uint8Array(new ArrayBuffer(rawLength));

            for (i = 0; i < rawLength; i++) {
                array[i] = raw.charCodeAt(i);
            }
            return array;
        }

        function showInCanvas(URI) {
            // See README for overview
            'use strict';
            // Fetch the PDF document from the URL using promises
            var pdfAsArray = convertDataURIToBinary(URI);
            PDFJS.getDocument(pdfAsArray).then(function (pdf) {
                // Using promise to fetch the page
                pdf.getPage(1).then(function (page) {
                    var scale = 2;
                    var viewport = page.getViewport(scale);
                    // Prepare canvas using PDF page dimensions
                    var canvas = document.getElementById("canvas1");
                    var context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    // Render PDF page into canvas context
                    var renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    page.render(renderContext);
                });
                pdf.getPage(2).then(function (page) {
                    var scale = 2;
                    var viewport = page.getViewport(scale);
                    // Prepare canvas using PDF page dimensions
                    var canvas = document.getElementById("canvas2");
                    var context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    // Render PDF page into canvas context
                    var renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    page.render(renderContext);
                });
            });
             
        }

        function printHTML() {
            $("#canvas1").hide();
            $("#canvas2").hide();
            $("#img1").show();
            $("#img2").show();
            $("#img1").attr('src', document.getElementById('canvas1').toDataURL('image/png'));
            $("#img2").attr('src', document.getElementById('canvas2').toDataURL('image/png'));
            $("#canvas1").remove();
            $("#canvas2").remove();
            aisNative.printToNetwork($("#mainContainer").html())
        }

        showInCanvas(uritest);

    </script>
</body>

</html>
