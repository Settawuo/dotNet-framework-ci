@model WBBEntity.PanelModels.FBBWebConfigModels.DormitoryMasterModel
@using WBBEntity.PanelModels;
@{
    string ADMIN001_H_02 = "";
    string L_DORMITORY_NAME_TH = "";
    string L_BUILDING_TH = "";
    string L_SUB_CONTRACT_CODE = "";
    string L_SUB_CONTRACT_NAME_TH = "";
    string L_SUB_CONTRACT_NAME_EN = "";
    string L_ADDRESS_ID = "";
   

    if (ViewBag.configscreen != null)
    {
        var configscreen = (List<LovValueModel>)ViewBag.configscreen;

        ADMIN001_H_02 = configscreen.Any(f => f.Name == "ADMIN001_H_02") ? configscreen.First(f => f.Name == "ADMIN001_H_02").LovValue1 : "";
        L_DORMITORY_NAME_TH = configscreen.Any(f => f.Name == "ADMIN001_SUB_H_DORMITORY_NAME_TH") ? configscreen.First(f => f.Name == "ADMIN001_SUB_H_DORMITORY_NAME_TH").LovValue1 : "";
        L_BUILDING_TH = configscreen.Any(f => f.Name == "ADMIN001_BUILDING_NAME") ? configscreen.First(f => f.Name == "ADMIN001_BUILDING_NAME").LovValue1 : "";
        L_SUB_CONTRACT_CODE = configscreen.Any(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_CD") ? configscreen.First(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_CD").LovValue1 : "";
        L_SUB_CONTRACT_NAME_TH = configscreen.Any(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_NAME_TH") ? configscreen.First(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_NAME_TH").LovValue1 : "";
        L_SUB_CONTRACT_NAME_EN = configscreen.Any(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_NAME_EN") ? configscreen.First(f => f.Name == "ADMIN001_SUB_H_SUBCONTRACT_NAME_EN").LovValue1 : "";
        L_ADDRESS_ID = configscreen.Any(f => f.Name == "ADMIN001_ADDRESS_ID") ? configscreen.First(f => f.Name == "ADMIN001_ADDRESS_ID").LovValue1 : "";
       }

    string INPUT_SUB_CONTRACT_CODE = "";
    string INPUT_SUB_CONTRACT_NAME_TH = "";
    string INPUT_SUB_CONTRACT_NAME_EN = "";
    string INPUT_ADDRESS_ID = "";
    string LENGTH_SUB_CONTRACT_CODE = "";
    string LENGTH_SUB_CONTRACT_NAME_TH = "";
    string LENGTH_SUB_CONTRACT_NAME_EN = "";
    string LENGTH_ADDRESS_ID = "";


    if (ViewBag.DormConstant != null)
    {
        var DormConstant = (List<FbbConstantModel>)ViewBag.DormConstant;
        INPUT_SUB_CONTRACT_CODE = DormConstant.Any(f => f.Field == "INPUT_SUBCONTRACT_CD") ? DormConstant.First(f => f.Field == "INPUT_SUBCONTRACT_CD").Validation : "";
        INPUT_SUB_CONTRACT_NAME_TH = DormConstant.Any(f => f.Field == "INPUT_SUBCONTRACT_NAME_TH") ? DormConstant.First(f => f.Field == "INPUT_SUBCONTRACT_NAME_TH").Validation : "";
        INPUT_SUB_CONTRACT_NAME_EN = DormConstant.Any(f => f.Field == "INPUT_SUBCONTRACT_NAME_EN") ? DormConstant.First(f => f.Field == "INPUT_SUBCONTRACT_NAME_EN").Validation : "";
        INPUT_ADDRESS_ID = DormConstant.Any(f => f.Field == "INPUT_ADDRESS_ID") ? DormConstant.First(f => f.Field == "INPUT_ADDRESS_ID").Validation : "";
        LENGTH_SUB_CONTRACT_CODE = DormConstant.Any(f => f.Field == "LENGTH_SUBCONTRACT_CD") ? DormConstant.First(f => f.Field == "LENGTH_SUBCONTRACT_CD").Validation : "";
        LENGTH_SUB_CONTRACT_NAME_TH = DormConstant.Any(f => f.Field == "LENGTH_SUBCONTRACT_NAME") ? DormConstant.First(f => f.Field == "LENGTH_SUBCONTRACT_NAME").Validation : "";
        LENGTH_SUB_CONTRACT_NAME_EN = DormConstant.Any(f => f.Field == "LENGTH_SUBCONTRACT_NAME") ? DormConstant.First(f => f.Field == "LENGTH_SUBCONTRACT_NAME").Validation : "";
        LENGTH_ADDRESS_ID = DormConstant.Any(f => f.Field == "LENGTH_ADDRESS_ID") ? DormConstant.First(f => f.Field == "LENGTH_ADDRESS_ID").Validation : "";
    }
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
</head>
<body>
    <div class="panel panel-success">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <i style="font-size: large;">&nbsp;@ADMIN001_H_02</i>
                </h3>
            </div>@*endpanel heading*@
 <div id="CoverageInformation" class="panel-collapse collapse in i-gap-top-1 i-gap-right-1 i-gap-left-1 i-gap-bottom-1">
                <div class="row">
                    <div class="col-sm-12 col-md-12">
                        <div class=" panel panel-default">
                            <div id="panelbodyCoverageIformation" class="panel-body">
                                <div>
                                    <div class="col-sm-6 col-md-6">
                                        <label>รายละเอียดข้อมูลหอพัก</label>
                                    </div>

                                    <div class="col-sm-12 col-md-12">
                                        <div class=" panel panel-default">
                                              <div id="panelbody1" class="panel-body">
                                                <div id="row1" class="row">
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_DORMITORY_NAME_TH<span id="requiredfor-Admin_Dormitory_Name"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @(Html.Kendo().DropDownListFor(t => t.dormitory_name_th)
                                              .Name("Admin_Dormitory_Name")
                                              .HtmlAttributes(new { @class = "form-control i-form-control-extend" })
                                              .DataTextField("DISPLAY_VAL")
                                              .DataValueField("LOV_NAME")
                                                                    //        .BindTo(new List<SelectListItem>() {
                                                                    //    //new SelectListItem() {
                                                                    //    //    Text = "จังหวัด",
                                                                    //    //    Value = ""
                                                                    //    //},
                                                                    //    new SelectListItem() {
                                                                    //        Text = "กรุณาเลือก",
                                                                    //        Value = ""
                                                                    //    }
                                                                    //})
                                            .DataSource(source =>
                                            {
                                                source.Read(read =>
                                                {
                                                    read.Action("SelectDormitoryName", "DormMasterDetail");
                                                });
                                            })
                                            .Events(e => e.Change("onDormitoryName"))
                                        )
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-Admin_Dormitory_Name"></div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_BUILDING_TH<span id="requiredfor-Admin_DormitoryBuilding_TH"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @(Html.Kendo().DropDownListFor(t => t.dormitory_no_th)
                                              .Name("Admin_DormitoryBuilding_TH")
                                              .HtmlAttributes(new { @class = "form-control i-form-control-extend" })
                                              .DataTextField("DISPLAY_VAL")
                                              .DataValueField("LOV_NAME")
                                                                    //        .BindTo(new List<SelectListItem>() {
                                                                    //    //new SelectListItem() {
                                                                    //    //    Text = "จังหวัด",
                                                                    //    //    Value = ""
                                                                    //    //},
                                                                    //    new SelectListItem() {
                                                                    //        Text = "กรุณาเลือก",
                                                                    //        Value = ""
                                                                    //    }
                                                                    //})
                                            .DataSource(source =>
                                            {
                                                source.Read(read =>
                                                {
                                                    read.Action("SelectDormitoryBuilding", "DormMasterDetail");
                                                });
                                            })
                                        )
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-Admin_DormitoryBuilding_TH"></div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_ADDRESS_ID<span id="requiredfor-AddressID"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @Html.TextBoxFor(t => t.AddressID, new { maxlength = @LENGTH_ADDRESS_ID, @class = "dis k-textbox form-control" })
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-AddressID"></div>
                                                    </div>
                                                    </div>
                                                      <div id="row2" class="row">
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_SUB_CONTRACT_CODE<span id="requiredfor-SubcontractID"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @Html.TextBoxFor(t => t.SubcontractID, new { maxlength = @LENGTH_SUB_CONTRACT_CODE, @class = "dis k-textbox form-control" })
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-SubcontractID"></div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_SUB_CONTRACT_NAME_TH<span id="requiredfor-SubcontractTH"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @Html.TextBoxFor(t => t.SubcontractTH, new { maxlength = @LENGTH_SUB_CONTRACT_NAME_TH, @class = "dis k-textbox form-control" })
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-SubcontractTH"></div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-4">
                                                        <label>@L_SUB_CONTRACT_NAME_EN<span id="requiredfor-SubcontractEN"></span></label>
                                                        <div class="i-fg-data-entry">
                                                            @Html.TextBoxFor(t => t.SubcontractEN, new { maxlength = @LENGTH_SUB_CONTRACT_NAME_EN, @class = "dis k-textbox form-control" })
                                                        </div>
                                                        <div class="i-fg-data-entry-validation" id="validatefor-SubcontractEN"></div>
                                                    </div>
                                                    </div>
                                                  </div>
                                        </div>
                                    </div>



                       
                                <div id="panelbody3" class="panel-body">
                                    <div id="row6" class="row">
                                        <div class="col-sm-12 col-md-12 i-text-align-center">
                                            <a class="btn btn-default" onclick="_Clear();"><i class="fa fa-ban fa-lg"></i>&nbsp;&nbsp;ยกเลิก</a>
                                            <a class="btn btn-info" onclick="Save();"><i class="fa fa-search fa-lg"></i>&nbsp;&nbsp;ตกลง</a>
                                        </div>
                                    </div>
                                </div>
                            </div>@*end panel*@
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
</body>
    <script>
        var validateModel = [];
        validateModel.push({ id: "Admin_Dormitory_Name" });
        validateModel.push({ id: "Admin_DormitoryBuilding_TH" });
        validateModel.push({ id: "AddressID" });
        validateModel.push({ id: "SubcontractID" });
        validateModel.push({ id: "SubcontractTH" });
        validateModel.push({ id: "SubcontractEN" });
        $(function () {
            SetRequired(validateModel);
        });
        function onDormitoryName() {
            $("#Admin_DormitoryBuilding_TH").data("kendoDropDownList").dataSource.read({ DormName: $("#Admin_Dormitory_Name").val() });
        }
        function ValidationIcon() {
            return "<i class='fa fa-warning i-red'></i> ";
        }
        function ValidationProcessingRequired(panel) {
            var chk = true;
            $("#" + panel + " .i-required").each(function (index, e) {
                var field = e.id.split('requiredfor-')[1];
                var value = $("#" + field).val();
                if ($.trim(value) == "") {
                    $("#validatefor-" + field).html(ValidationIcon() + "This field is required.");
                    chk = false;
                }
                else {
                    $("#validatefor-" + field).html("");
                }
            });

            if (chk) {
                $("#" + panel + " .i-validate-length").each(function (index, e) {
                    var field = e.id.split('validatefor-')[1];
                    var value = $("#" + field).val();
                    var length = parseInt(e.className.split('i-length-')[1]);
                    var val_length = 0;
                    if (value != "") {
                        val_length = value.length;
                    }

                    if (val_length > length) {
                        $("#" + e.id).html(ValidationIcon() + "This maxlength field is " + length + ".");
                        chk = false;
                    }
                    else {
                        $("#" + e.id).html("");
                    }
                });
            }

            return chk;
        }

        function SetRequired(validateModel) {
            var i = 0;
            for (i = 0; i < validateModel.length; i++) {
                var id = validateModel[i].id;
                $("#requiredfor-" + id).addClass("label label-danger i-gap-left-md i-required");
                $("#requiredfor-" + id).text("Required");
            }
        }

        function SetValidateLength(validateLengthModel) {
            var i = 0;
            for (i = 0; i < validateLengthModel.length; i++) {
                var id = validateLengthModel[i].id;
                var length = validateLengthModel[i].length;
                if (length !== undefined) {
                    $("#validatefor-" + id).addClass("i-validate-length i-length-" + length);
                }
            }
        }

        function RemoveRequired(panel) {
            $("#" + panel + " span[id*=requiredfor-]").removeClass("label label-danger i-gap-left-md i-required");
            $("#" + panel + " span[id*=requiredfor-]").text("");
            ClearTextValidation(panel);
        }

        function ClearTextValidation(panel) {
            $("#" + panel + " .i-required").each(function (index, e) {
                var field = e.id.split('requiredfor-')[1];
                $("#validatefor-" + field).text("");
            });
        }

        function RemoveValidation(validateModel) {
            var i = 0;
            for (i = 0; i < validateModel.length; i++) {
                var id = validateModel[i].id;
                $("#validatefor-" + id).html("");
            }
        }

        function CheckKeyUps(id, RexStr) {
            var strKey = $("#" + id).val();
            var strBuilder = "";
            var filter = new RegExp(RexStr);
            for (var i = 0; i < strKey.length; i++) {
                if (filter.test(strKey.substr(i, 1))) {
                    strBuilder += strKey.substr(i, 1);
                }
            }
            $("#" + id).val(strBuilder);

        }

        $("#AddressID").keyup(function () {
            CheckKeyUps("AddressID", '@INPUT_ADDRESS_ID');
        });
        $("#SubcontractID").keyup(function () {
            CheckKeyUps("SubcontractID", '@INPUT_SUB_CONTRACT_CODE');
        });
        $("#SubcontractTH").keyup(function () {
            CheckKeyUps("SubcontractTH", '@INPUT_SUB_CONTRACT_NAME_TH');
        });
        $("#SubcontractEN").keyup(function () {
            CheckKeyUps("SubcontractEN", '@INPUT_SUB_CONTRACT_NAME_EN');
        });
       @* $('#AddressID').inputmask('Regex', {
            regex: "@INPUT_ADDRESS_ID",
           });*@
        @*$('#SubcontractID').inputmask('Regex', {
            regex: "@INPUT_SUB_CONTRACT_CODE",
    });
        $('#SubcontractTH').inputmask('Regex', {
        regex: "@INPUT_SUB_CONTRACT_NAME_TH",
    });
        $('#SubcontractEN').inputmask('Regex', {
            regex: "@INPUT_SUB_CONTRACT_NAME_EN",
    });*@
        
        function Save() {

            var chk = ValidationProcessingRequired("panelbodyCoverageIformation");
            if (chk) {
                Loading();
                $.ajax({
                    type: "POST",
                    url: "/DormMasterDetail/SaveDormDetailMaster",
                    data: {
                        "dormitory_name_th": $("#Admin_Dormitory_Name").val(), "dormitory_no": $("#Admin_DormitoryBuilding_TH").val(), "addressid": $("#AddressID").val()
                        , "SubcontractCode": $("#SubcontractID").val(), "SubcontractTH": $("#SubcontractTH").val(), "SubcontractEN": $("#SubcontractEN").val()
                         },
                    dataType: "json",
                    async: false,
                    success: function (response) {
                        Loading(0);
                        showFeedback("success", "Save Success", "SaveDormitory Master Detail");

                    },
                    failure: function (err) {
                        Loading(0);
                        showFeedback("error", "Save Fail", "SaveDormitory Master Detail");
                    }

                });
                _Clear();
            }
        }
        function _Clear() {
            $("#Admin_Dormitory_Name").data("kendoDropDownList").select(0);
            $("#Admin_DormitoryBuilding_TH").data("kendoDropDownList").select(0);
            $("#AddressID").val("");
            $("#SubcontractID").val("");
            $("#SubcontractTH").val("");
            $("#SubcontractEN").val("");
            RemoveValidation(validateModel);
            onDormitoryName();
        }
    </script>
</html>
