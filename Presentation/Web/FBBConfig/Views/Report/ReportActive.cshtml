@{
    ViewBag.Title = "ReportActive";
}
<div class="page-header i-header-fit">
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <h3 style="margin-top: 0">Report Active Subs by Region</h3>
        </div>
    </div>
</div>

<div class="panel panel-success">
        <div class="panel-heading">
            <h3 class="panel-title">
                <span>Search Panel</span>
                <a data-toggle="collapse" class="pull-right" href="#SearchPanel" onclick="onPanelToggle(this);" id="SearchPanelHeader"><i class="fa fa-chevron-circle-down fa-lg" id="SearchPanelHeaderArrow"></i></a>
            </h3>
        </div>
        <div id="SearchPanel" class="panel-collapse collapse in">
            <div class="panel-body" style="min-height: 200px;">

                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Region</label>
                            <div class="i-fg-data-entry">
                                @(Html.Kendo().DropDownList()
                                          .Name("RegionActive")
                                          .HtmlAttributes(new { @class = "form-control i-form-control-extend" })
                                          .DataTextField("DISPLAY_VAL")
                                          .DataValueField("LOV_NAME")
                                          .DataSource(source =>
                                          {
                                              source.Read(read =>
                                              {
                                                  read.Action("SelecRegion_ByRegion", "MasterData", new { type = "REGION_CODE" });
                                              });
                                          })
                                          //.Events(e => e.Change("onChange"))
                                    )
                            </div>
                        </div>
                    </div>
                    <div class="row" id="dateselect">
                     <div class="col-md-3">
                        <div class="form-group">
                            <label>Date From <span id="requiredfor-Active_Date_From"></span></label>
                            <div class="i-fg-data-entry">
                                 @(Html.Kendo().DatePicker().Name("Active_Date_From").HtmlAttributes(new { @class = "form-control i-form-control-extend" }).Format("dd/MM/yyyy").Events(e => e.Change("Change_Active_Date_From")))
                                 <div class="i-fg-data-entry-validation" id="validatefor-Active_Date_From"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Date To <span id="requiredfor-Active_Date_To"></span></label>
                            <div class="i-fg-data-entry">
                                 @(Html.Kendo().DatePicker().Name("Active_Date_To").HtmlAttributes(new { @class = "form-control i-form-control-extend" }).Format("dd/MM/yyyy").Events(e => e.Change("Change_Active_Date_TO")))
                                 <div class="i-fg-data-entry-validation" id="validatefor-Active_Date_To"></div>
                            </div>
                        </div>
                    </div>


                        
                   
                          <label></label>
                        <div class="i-fg-data-entry">                            
                                <a onclick="onSearch()" class="btn btn-info i-width-sm"><i class="fa fa-search fa-lg"></i>&nbsp;&nbsp;ค้นหา</a>
                        </div>
                   


                </div>



                      
                    </div>                
                </div>

                <div class="i-enter-4"></div>

                <div class="row i-hidden" id="loading">
                    <div class="col-md-12 i-text-align-center">
                        <i class="fa fa-spinner fa-spin i-fa-2"></i>
                        <div class="i-enter-2"></div>
                        <span class="i-red">Report กำลังคำนวณ ระบบจะแจ้งเตือนทาง Email หลังจากทำงานเสร็จ<br />
                        คุณสามารถปิด Page นี้ได้ทันที</span>
                    </div>
                </div>

            </div>
        </div>
    </div>   

<script>
    //function onChange() {
    //    $("#DSLMDID").data("kendoDropDownList").dataSource.read({ nodeNameTH: $("#ProjectName").val() });
    //}

    $(function () {       
       
        var validateModel = [];
        validateModel.push({ id: "Active_Date_To" });
        validateModel.push({ id: "Active_Date_From" });        
       
        SetRequired(validateModel);
    });

    function Change_Active_Date_From() {
        
        var endPicker = $("#Active_Date_To").data("kendoDatePicker"),
            startDate = this.value();

        if (startDate) {
            startDate = new Date(startDate);
            startDate.setDate(startDate.getDate());
            endPicker.min(startDate);
        }
    }

    function Change_Active_Date_TO() {
        
        var startPicker = $("#Active_Date_From").data("kendoDatePicker"),
            endDate = this.value();

        if (endDate) {
            endDate = new Date(endDate);
            endDate.setDate(endDate.getDate());
            startPicker.max(endDate);
        }
    }

    function onSearch() {
        //alert($("#RegionActive").val());
        var chk = ValidationProcessing("dateselect");
        var from = $("#Active_Date_From").val().toString();
        var to =   $("#Active_Date_To").val().toString();
        if (chk) {
            //alert(from + ' ' + to);
            $("#loading").fadeIn("slow");
            setTimeout("timing()", 5000);

            $.ajax({
                url: '/Report/SearchActive',
                data: {
                    region: $("#RegionActive").val(), datefrom: from, dateto: to
                },
                dataType: "json",
                type: 'POST',
                success: function (data) {

                }
            });
        }        
    }

    function timing() {
        window.location.href = "@Url.Action("ReportActive", "Report")";
    }
</script>