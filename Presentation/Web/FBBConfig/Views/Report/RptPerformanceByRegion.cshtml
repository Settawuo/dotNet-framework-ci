@{
    ViewBag.Title = "RptPerformanceByRegion";
}

@*<h2>Report Performance by Region</h2>*@
@*<div class="box">
   
    <h4>Search</h4>
       <input type="text" value="0" id="textboxID" class="k-textbox form-control"/>
            <button class="toggleGroup k-button" onclick="getMyReport();">Search</button>  
           
</div>

<div id="resultID">


</div>*@


<div class="page-header i-header-fit">
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <h3 style="margin-top: 0">Performnce by Region</h3>
        </div>
    </div>
</div>

<div class="panel panel-success">
        <div class="panel-heading">
            <h3 class="panel-title">
                <span>Search Panel</span>
                <a data-toggle="collapse" class="pull-right" href="#SearchPanel_By_Region" onclick="onPanelToggle(this);" id="SearchPanelHeader"><i class="fa fa-chevron-circle-down fa-lg" id="SearchPanelHeaderArrow"></i></a>
            </h3>
        </div>
        <div id="SearchPanel_By_Region" class="panel-collapse collapse in">
            <div class="panel-body" style="min-height: 370px;">

                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Region   <span id="requiredfor-Region_Data"></span></label>
                            <div class="i-fg-data-entry">
                                 @(Html.Kendo().DropDownList()
                                          .Name("Region_Data")
                                          .HtmlAttributes(new { @class = "form-control i-form-control-extend" })
                                          .DataTextField("DISPLAY_VAL")
                                          .DataValueField("LOV_NAME")
                                          .DataSource(source =>
                                          {
                                              source.Read(read =>
                                              {
                                                  read.Action("SelecRegion_ByRegion", "MasterData", new { type = "REGION_CODE" });
                                              });
                                          })
                                         
                                    )
                            </div>

                             <div class="i-fg-data-entry-validation" id="validatefor-Region_Data"></div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Install Date From  <span id="requiredfor-Install_Date_From"></span></label>
                            <div class="i-fg-data-entry">
                                 @(Html.Kendo().DatePicker().Name("Install_Date_From").HtmlAttributes(new { @class = "form-control i-form-control-extend" }).Format("dd/MM/yyyy").Events(e => e.Change("Chang_Install_Date_From")))
                            </div>


                           
                        </div>
                            <div class="i-fg-data-entry-validation" id="validatefor-Install_Date_From"></div>
                    </div>


                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Install Date To  <span id="requiredfor-Install_Date_To"></span></label>
                            <div class="i-fg-data-entry">
                                 @(Html.Kendo().DatePicker().Name("Install_Date_To").HtmlAttributes(new { @class = "form-control i-form-control-extend" }).Format("dd/MM/yyyy").Events(e => e.Change("Chang_Install_Date_TO")))
                            </div>
                        </div>

                         <div class="i-fg-data-entry-validation" id="validatefor-Install_Date_To"></div>
                    </div>



                    <div class="col-md-3">
                        <label></label>
                        <div class="i-fg-data-entry">                            
                                <a onclick="onSearch('add_Sarch_Data')" class="btn btn-info i-width-sm"><i class="fa fa-search fa-lg"></i>&nbsp;&nbsp;ค้นหา</a>
                           

                            
                             </div>


                    </div>
                </div>



                <div class="i-enter-4"></div>

                <div class="row i-hidden" id="loading">
                    <div class="col-md-12 i-text-align-center">
                        <i class="fa fa-spinner fa-spin i-fa-2"></i>
                        <div class="i-enter-2"></div>
                        <span class="i-red">Report กำลังคำนวณ ระบบจะแจ้งเตือนทาง Email หลังจากทำงานเสร็จ<br />
                        คุณสามารถปิด Page นี้ได้ทันที</span>
                    </div>
                </div>
                     <input type="hidden" id="Programe_Code_Data" />
                                <input type="hidden" id="Programe_Description_Data" />
            </div>
        </div>
    </div>   















        <script>
            $(function () {

                var validateModel = [];
                validateModel.push({ id: "Install_Date_From" });
                validateModel.push({ id: "Install_Date_To" });


                SetRequired(validateModel);
            });




            function Chang_Install_Date_From() {
                
                var endPicker = $("#Install_Date_To").data("kendoDatePicker"),
             startDate = this.value();



                if (startDate) {
                    startDate = new Date(startDate);
                    startDate.setDate(startDate.getDate());
                    endPicker.min(startDate);
                }
              
            }

            function Chang_Install_Date_TO() {
                
                
                var startPicker = $("#Install_Date_From").data("kendoDatePicker"),
                  endDate = this.value();

                if (endDate) {
                    endDate = new Date(endDate);
                    endDate.setDate(endDate.getDate());
                    startPicker.max(endDate);
                }

            }           

     
            function onSearch(dataserch) {
                var chk = ValidationProcessing("SearchPanel_By_Region");         
                if (chk) {    /// success


                    var Programe_Code_Data = "";
                    var Programe_Description_Data = "";
                    if (dataserch == "add_Sarch_Data") {

                        $.ajax({
                            url: '/Report/Getprogram_description',
                            data: {

                            },
                            dataType: "json",
                            type: 'POST',
                            success: function (data) {

                                //public string program_name { get; set; }
                                //public string program_Code { get; set; }
                                var REPORT_NAME = data[0].program_name;
                                var REPORT_DESC = data[0].program_descriptiontext;



                                var REPORT_NAME_data = $("#Programe_Code_Data").val();
                                var REPORT_DESC_data = $("#Programe_Description_Data").val();
                                var region = $("#Region_Data").data("kendoDropDownList").value();

                                var Install_Date_From = $("#Install_Date_From").val();

                                var Install_Date_To = $("#Install_Date_To").val();
                                var REPORT_PARAMETER = region + "|" + Install_Date_From.toString() + "|" + Install_Date_To.toString();
                                var REPORT_STATUS = "ON_PROCESS@AIR";


                                $.ajax({
                                    url: '/Report/Add_RptPerformanceByRegion',
                                    data: {
                                        REPORT_NAME: REPORT_NAME, REPORT_DESC: REPORT_DESC, REPORT_PARAMETER: REPORT_PARAMETER, REPORT_STATUS: REPORT_STATUS

                                    },
                                    dataType: "json",
                                    type: 'POST',
                                    success: function (data) {


                                    }
                                });


                            }


                        });


                        $("#loading").fadeIn("slow");
                        setTimeout("timing()", 5000);



                    } else {




                    }
                }
               


              

              
            }

                function timing() {
                    window.location.href = "@Url.Action("RptPerformanceByRegion", "Report")";
                }
        </script>