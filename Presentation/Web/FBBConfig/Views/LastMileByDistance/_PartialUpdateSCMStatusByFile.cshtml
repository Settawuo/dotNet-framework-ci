@{
    string B_CONFIRM = "CONFIRM";
    string B_CLOSE = "CLOSE";
    string B_EXPORT = "EXPORT Template";
}

<div style="padding: 15px;">
    <div class="row">
        <div class="form-group">
            <label>Update Status to <span style="color: red;">&nbsp;*</span></label>
            @(Html.Kendo().DropDownList()
                  .Name("ddlSCMStatus")
                  .HtmlAttributes(new { @class = "form-control i-form-control-extend" })
                  .DataTextField("DISPLAY_VAL")
                  .DataValueField("LOV_VAL1")
                  .DataSource(source =>
                  {
                      source.Read(read =>
                      {
                          read.Action("StatusUpdateByFile", "LastMileByDistance");

                      });

                  }).Events(e => e.Change("onchangeSCMStatus"))
            )
            <div class="i-fg-data-entry-validation" id="validatefor-ddlSCMStatus"></div>
        </div>
    </div>
    <div class="row">
        <label>Import File</label>
        @(Html.Kendo().Upload()
              .Name("scmLastMilefile")
              .HtmlAttributes(new
              {
                  accept = ".csv, text/csv, application/csv"
              })
              .Async(a => a
                  .Save("ScmLastMilefile_Save", "LastMileByDistance")
                  .Remove("ScmLastMilefile_Remove", "LastMileByDistance")
                  .AutoUpload(true))
              .Multiple(false)
              .Events(e => e.Success("onScmLastMilefileSuccess"))
              .Events(e => e.Error("onScmLastMilefileError"))
        )
        <div class="i-fg-data-entry-validation" id="validatefor-scmLastMilefile"></div>
    </div>
    <div class="row i-gap-top-1">
        <div class="i-text-align-center">
            <a id="btnCancelUpdateSCMStatusByFile" class="btn btn-danger"><i class="fa fa-ban fa-lg"></i>&nbsp;&nbsp;@B_CLOSE</a>
            <a id="btnExportTemplate" class="btn btn-success"><i class="fa fa-file-excel-o fa-lg"></i>&nbsp;&nbsp;@B_EXPORT</a>
            <a id="btnConfirmUpdateSCMStatusByFile" class="btn btn-success"><i class="fa fa-check-square-o fa-lg"></i>&nbsp;&nbsp;@B_CONFIRM</a>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#btnExportTemplate").attr("disabled", true);
        $("#btnConfirmUpdateSCMStatusByFile").on('click', function () {
            submitUpdateSCMStatusByFile();
        });

        $("#btnCancelUpdateSCMStatusByFile").on('click', function () {
            resetUpdateScmStatusByFile();
        });
        $("#btnExportTemplate").on('click', function () {
            ExportTemple();
        });
      
    });

    function resetUpdateScmStatusByFile() {
        $("#ddlSCMStatus").data('kendoDropDownList').value("ALL");
        $(".k-upload-files").remove();
        $(".k-upload-status").remove();
        $("#validatefor-ddlSCMStatus").html("");
        $("#validatefor-scmLastMilefile").html("");
        $("#UpdateStatusByFileConfig").data("kendoWindow").close();
    }

    function submitUpdateSCMStatusByFile() {
        if (!ValidationUpdateScmStatusbyFileValue()) { return; }

        var data = JSON.stringify({
            "status": $("#ddlSCMStatus").val(),
            "fileName": $(".k-filename").text()
        });
        $.ajax({
            type: "POST",
            contentType: 'application/json',
            url: "/LastMileByDistance/LastMileByDistanceUpdateByFile",
            data: data,
            async: false,
            dataType: "json",
            success: function (response) {
                if (response) {
                    resetUpdateScmStatusByFile();
                    if (response === "Update file success.") {
                        showFeedback("success", response, "System Information");
                    } else {
                        showFeedback("error", response, "System Information");
                    }
                }
            },
            failure: function (msg) {
                $("#validatefor-scmLastMilefile").html(ValidationIcon() + msg);
            }

        });
    }

    function onScmLastMilefileSuccess(e) {
        $(".k-filename").text(e.response.fileName);
        if (!e.response.status) {
            $("#validatefor-scmLastMilefile").html(ValidationIcon() + e.response.message);
        } else {
            $("#validatefor-scmLastMilefile").html("");
        }
    };

    function onScmLastMilefileError(e) {
        if (!e.response.status) {
            $("#validatefor-scmLastMilefile").html(ValidationIcon() + e.response.message);
        }
    };

    function ValidationUpdateScmStatusbyFileValue() {
        var error = true;
        if ($("#ddlSCMStatus").val() === "ALL" || $("#ddlSCMStatus").val() === "") {
            $("#validatefor-ddlSCMStatus").html(ValidationIcon() + "This field is required.");
            error = false;
        } else {
            $("#validatefor-ddlSCMStatus").html("");
        }

        if ($("#validatefor-scmLastMilefile").html()) {
            error = false;
        }

        if (!$(".k-filename").text()) {
            $("#validatefor-scmLastMilefile").html(ValidationIcon() + "Please upload file.");
            error = false;
        }

        return error;
    }
    function onchangeSCMStatus()
    {
        var status = $("#ddlSCMStatus").val();
        if (status != "ALL") {
            $("#btnExportTemplate").attr("disabled", false);
        }
        else {
            $("#btnExportTemplate").attr("disabled", true);
        }

    }
    function ExportTemple() {
        var Status = $("#ddlSCMStatus").val();
        window.open("/LastMileByDistance/ExportSample?Status=" + Status + "");
    }

</script>